<!-- website/index.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Serverless Web App</title>
  </head>
  <body>
    <h1>Welcome to my Serverless Web App!</h1>
    <p>This is a static website hosted on AWS S3.</p>

    <h2>Data</h2>
    <form id="data-form">
      <label for="name">File Name:</label>
      <input placeholder="data/ManagersHalf.csv" type="text" id="name" name="name" required />
      <br />
      <button type="submit">Submit</button>
    </form>

    <h2>String</h2>
    <p>String from backend will be displayed here.</p>
    <div id="team_lookup"></div>
    
    <h2>Table</h2>
    <p>Table from backend will be displayed here.</p>
    <table id="data-table" border="1">
      <thead>
        <tr id="table-header"></tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>

    <script>
      const form = document.getElementById('data-form');
      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const team_lookup_response = await fetch('https://osir3dme2h.execute-api.us-east-1.amazonaws.com/dev/team_lookup?year=1936&team=New+York+Yankees', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          },
        });

        const team_lookup_data = await team_lookup_response.json();
        console.log(team_lookup_data);
        document.getElementById('team_lookup').textContent = team_lookup_data.team;

        const file_name = document.getElementById('name').value;

        const response = await fetch('https://osir3dme2h.execute-api.us-east-1.amazonaws.com/dev/read_csv', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ file_name }),
        });

        const data = await response.json();
        console.log(data);
        form.reset();

        // Clear previous table data
        document.getElementById('table-header').innerHTML = '';
        document.getElementById('table-body').innerHTML = '';

        if (data.length > 0) {
          // Create table header
          const headers = Object.keys(data[0]);
          const headerRow = document.getElementById('table-header');
          headers.forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
          });

          // Create table body
          const tableBody = document.getElementById('table-body');
          data.forEach(row => {
            const tr = document.createElement('tr');
            headers.forEach(header => {
              const td = document.createElement('td');
              td.textContent = row[header];
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          });
        }
      });
    </script>
  </body>
</html>
